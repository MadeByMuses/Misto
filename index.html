<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://unpkg.com/98.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="Main_screen.css">
    <link rel="icon" type="image/x-icon" href="../Resources/Icon.png">
    <title>–º—ñ—Å—Ç–æ</title>
</head>
<body>

<div class="blocker" id="Blocker">
  <h1>Misto</h1>
  <div class="databox">
    <div class="window">
      <div class="title-bar">
        <div class="title-bar-text">Misto.exe</div>
      <div class="title-bar-controls">
        <button aria-label="Help"></button>
        <button aria-label="Close"></button>
      </div>
    </div>
    <div class="window-body">
        <label for="userInput" style="color:black">Insert save data below (If starting new, please do not enter anything in the box below):</label><br><br>
        <input type="file" id="jsonFileInput" accept=".json">
      </div>
    </div>
  </div>
<br>
<button onclick="StartGame()">Begin the adventure</button>
</div>


<!--Heading-->
<div class="title-bar title-bar-heading">
  <div id="title-bar-text" class="title-bar-text">Town_Name.Mistro.exe</div>
  <div class="title-bar-controls">
    <button aria-label="Minimize" onclick="Click.play()"></button>
    <button aria-label="Restore" onclick="Click.play()"></button>
    <button aria-label="Close" onclick="Click.play()"></button>
  </div>
</div>
<div class="gridDetails">
    
  <div class="PublicSector">
    <div class="window">
      <div class="title-bar" style="background: linear-gradient(90deg,#7e0000,#fe0000);">
        <div class="title-bar-text">Public Sector üèõÔ∏è</div>
      </div>
      <div class="window-body">
        <ul class="tree-view" style="overflow-y: scroll;height:100%">
          <li>
            <details open>
              <summary>Electricity ‚ö°- $<span id="ElectricityProfit"></span></summary>
              <ul>
                <li class="cost">Cost: $<span id="ElectricityCost"></span></li>
                <li class="revenue">Revenue: $<span id="ElectricityRevenue"></span></li>
                <li>Production: <span id="ElectricityProduction"></span> MW</li>
                <li>Consumption:<span id="ElectricityConsumption"></span> MW</li>
              </ul>
            </details>
          </li>
          <li>
            <details open>
              <summary>Water üíß- $<span id="WaterProfit"></span></summary>
              <ul>
                <li class="cost">Cost: $<span id="WaterCost"></span></li>
                <li class="revenue">Revenue: $<span id="WaterRevenue"></span></li>
                <li>Production: <span id="WaterProduction"></span> m&sup3;</li>
                <li>Consumption:<span id="WaterConsumption"></span> m&sup3;</li>
              </ul>
            </details>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <!--Overview-->
  <div class="Overview">
    <div class="window">
      <div class="title-bar"  style="background: linear-gradient(90deg,#047e7e,#06ffff);">
        <div id="Overview-window-header" class="title-bar-text"></div>
      </div>
      <div class="window-body">
        <p id="Population-overview"></p>
        <p id="Money-overview"></p>
        <p id="Happiness-overview"></p>
        <hr>
      </div>
    </div>
  </div>
  <div class="PolicySector">
    <div class="window">
      <div class="title-bar"  style="background: linear-gradient(90deg,#047e00,#06ff04);">
        <div class="title-bar-text">Policies</div>
      </div>
      <div class="window-body">
        <div id="MediaLocked" style="visibility: visible;">
          <p>This is currently unavailable... coming soon!</p>
        </div>
        <div id="MediaUnlocked" style="visibility: hidden;">
          <p>Uh oh, you are not supposed to see this!</p>
        </div>
      </div>
    </div>
  </div>
  <div class="PrivateSector">
    <div class="window">
      <div class="title-bar"  style="background: linear-gradient(90deg,#7e7e00,#ffff04);">
        <div class="title-bar-text">Private Sector üíº</div>
      </div>
      <div class="window-body" style="height: auto">
        <ul class="tree-view" style="overflow-y: scroll;height:100%">
          <li>
            Resource Extraction & Agriculture
            <ul>
              <li>Farms: </li>
              <li>Forestry:</li>
              <li>Mines: </li>
              <li>Aquaculture:</li>
              <li>Oil & Gas:</li>
            </ul>
          </li>
          <li>
            Manufacturing & Industrial Production
            <ul>
              <li>Textiles & Clothing:</li>
              <li>Automobile:</li>
              <li>Circuit Board:</li>
              <li>Food processing:</li>
              <li>Chemicals & Pharmaceuticals</li>
              <li>Construction Materials:</li>
              <li>Furniture:</li>
            </ul>
          </li>
          <li>
            Retail
            <ul>
              <li>Supermarket & Grocery stores:</li>
              <li>Clothing & Fashion:</li>
              <li>Technology:</li>
              <li>Homeware:</li>
              <li>Automechanic:</li>
            </ul>
          </li>
          <li>
            Finance & Legal services
            <ul>
              <li>Banking & Investments:</li>
              <li>Legal & Consulting:</li>
              <li>Real Estate:</li>
            </ul>
          </li>
          <li>
            Communication
            <ul>
              <li>Newspapers & Publishing</li>
              <li>TV & Radio</li>
              <li>Telecommunications:</li>
              <li>Social Media</li>
            </ul>
          </li>
          <li>
            High-tech Industry
            <ul>
              <li>Aerospace:</li>
              <li>Software:</li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class ="Media">
    <div class="window">
      <div class="title-bar">
        <div class="title-bar-text">Media</div>
      </div>
      <div class="window-body">
        <div id="MediaLocked" style="visibility: visible;">
          <p>This is currently unavailable... coming soon!</p>
        </div>
        <div id="MediaUnlocked" style="visibility: hidden;">
          <p>Uh oh, you are not supposed to see this!</p>
        </div>
      </div>
    </div>
  </div>
  <!--Options content-->
  <div class="Options">
    <div class="window">
      <div class="title-bar inactive">
        <div class="title-bar-text">Options</div>
      </div>
      <div class="window-body">
        <p>To save your current game for future play, please press below and save it elsewhere:</p>
        <button class="default" id="Export_Save" onclick="SaveDataOpen()">Export save data</button>
        <br><hr>
        <p>Configurations</p>
        <div class="field-row" style="width: 100%">
          <label>Volume:</label>
          <label>Low</label>
          <input type="range" id="Volume" min="0" max="1" step="0.1" value="1" oninput="Volume(this.value)"/>
          <label>High</label>
        </div>
        <br><hr>
        <p>Credits for this fun project!</p>
        <button class="default" id="CreditsButton" onclick="CreditsOpen()">Credits</button>
      </div>
    </div>
  </div>
  <div class="Census">
    <div class="window">
      <div class="title-bar inactive"  style="background: linear-gradient(90deg,#7e007e,#fe00ff);">
        <div class="title-bar-text">Census Center</div>
      </div>
      <div class="window-body">
        <div id="CensusLocked" style="visibility: visible;">
          <p>This is currently unavailable... coming soon!</p>
        </div>
        <div id="CensusUnlocked" style="visibility: hidden;">
          <p>Uh oh, you are not supposed to see this!</p>
        </div>
      </div>
    </div>
  </div>
  <div class="Continue">
    <div class="window">
      <div class="title-bar">
        <div class="title-bar-text">Proceed with effects</div>
      </div>
      <div class="window-body">
        <p>Below is all of the listed changes</p>
        <ul class="tree-view" style="height: 100px; overflow-y: scroll;">
        </ul>
        <p>Press the button below to continue towards next week!</p>
        <button class="default" onclick="NextCycle()">Next week</button>
      </div>
    </div>
  </div>
</div>

<!--Popup Windows-->
<div class="background-window" id="CreditsWindow">
  <div id="CreditsPopup">
    <div class="window popup" id="CreditsPopupHeader" style="width: 500px">
      <div class="title-bar inactive" >
        <div class="title-bar-text">Credits</div>
        <div class="title-bar-controls">
          <button aria-label="Close" id="CreditsWindowButton" onclick="CreditsClose()"></button>
      </div>
      </div>
      <div class="window-body" style="min-height: 300px;">
         <div class="split">
            <div>
              <h2><u>Credits ‚ú®</u></h2>
              <ul class="tree-view">
                <li>Creative Director: Louis B</li>
                <li>
                  Credited work towards
                  <ul>
                    <li>Jdan - <a href="https://jdan.github.io/98.css/">98.css</a></li>
                    <li>ttsmaker - <a href="https://ttsmaker.com/">ttsmaker.com</a></li>
                    <li>Emojipedia - <a href="https://emojipedia.org/">emojipedia.org</a></li>
                    <li>Voicechanger- <a href="https://voicechanger.io/voicemaker/#!/{%22effects%22:[{%22name%22:%22bitcrusher%22,%22params%22:{%22bits%22:4,%22normfreq%22:0.1,%22bufferSize%22:4096}}],%22version%22:1}">voicechanger.io</a></li>
                    <li>Audiotrimmer - <a href="https://audiotrimmer.com/">audiotrimmer.org</a></li>
                    <li>R-0-T-0 - <a href="https://pixabay.com/users/r-0-t-0-34451638/">Click sound effect</a></li>
                  </ul>
                </li>
                <li>
                  <details>
                  <summary>Louis B</summary>
                  <ul>
                    <li>Lead programmer</li>
                    <li>Procedural Generation Designer </li>
                    <li>Writer</li>
                    <li>Researcher</li>
                  </ul>
                </details>
                </li>
              </ul>
            </div>
            <div>
              <ul class="tree-view">
                <li>Many thanks towards</li>
                  <ul>
                    <li>Well currently nobody...</li>
                </li>
              </ul>
            </div>
         </div>
      </div>
    </div>
  </div>
</div>

<div class="background-window" id="SaveDataWindow">
  <div id="SaveDataPopup">
    <div class="window popup" style="width: 500px">
      <div id="SaveDataPopupHeader">
        <div class="title-bar inactive" >
          <div class="title-bar-text">Save Data</div>
          <div class="title-bar-controls">
            <button aria-label="Close" id="SaveDataButton" onclick="SaveDataClose()"></button>
          </div>
        </div>
      </div>
      <div class="window-body" style="height: 300px;">
        <div class="field-row-stacked">
          <label for="SaveData" style="color:black">Please keep this safe üíæ</label>
          <textarea id="SaveData" rows="8" style="resize: none;height:280px"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>




<script>

var Begin = new Audio("Begin.wav");
var Click = new Audio("Click.mp3");
var Credits = new Audio("Credits.wav");
var Save = new Audio("Save.wav");
var Simulate = new Audio("Simulate.wav");
var Testing = new Audio("Testing.wav");
if (localStorage.getItem("Volume") != undefined){
  Volume(localStorage.getItem("Volume"))
  document.getElementById("Volume").value = localStorage.getItem("Volume")
}
//This is the massive JSON that has everything in it!!
var jsonData;

function Volume(audiopercentage){
  Begin.volume = audiopercentage;
  Click.volume = audiopercentage;
  Credits.volume = audiopercentage;
  Simulate.volume = audiopercentage;
  Testing.volume = audiopercentage;
  Save.volume = audiopercentage;

  console.log(document.getElementById("Blocker").classList);
  if (document.getElementById("Blocker").classList.contains("animateExit"))
  {
    Testing.play();
  }
  localStorage.setItem("Volume",audiopercentage)
}

document.getElementById('jsonFileInput').addEventListener('change', function(event) {
    const file = event.target.files[0]; // Get the uploaded file

    if (file) {
      const reader = new FileReader();

      reader.onload = function(event) {
        try {
          jsonData = JSON.parse(event.target.result); // Parse JSON
          console.log(jsonData); // Log data
          
          localStorage.setItem('uploadedJson', JSON.stringify(jsonData)); // Store in localStorage
        } catch (error) {
          console.error('Error parsing JSON:', error);
          alert('Invalid JSON file.');
        }
      };

      reader.readAsText(file); // Read file as text
    }
  });

var menuCurrentlyOpen = false;
function StartGame() {
    TownNameUpdate();
    UpdateAllVariables();

    //blocker remover
    Begin.play();
    const blocker = document.querySelector(".blocker");
    blocker.classList.add("animateExit");
    console.log("Blocker removed");
}
function CreditsOpen() {
  if (!menuCurrentlyOpen){
    menuCurrentlyOpen = true
    Credits.play()
    document.getElementById("CreditsWindow").style.visibility = "visible";
  }

}
function CreditsClose() {
  Click.play()
  menuCurrentlyOpen = false
  document.getElementById("CreditsWindow").style.visibility = "hidden";
}

function SaveDataOpen() {
  if (!menuCurrentlyOpen){
    menuCurrentlyOpen = true
    Save.play()
    document.getElementById("SaveData").innerHTML = JSON.stringify(jsonData);
    document.getElementById("SaveDataWindow").style.visibility = "visible";

  }

}
function SaveDataClose() {
  Click.play()
  menuCurrentlyOpen = false
  document.getElementById("SaveDataWindow").style.visibility = "hidden";
}
//Draggable elements
dragElement(document.getElementById("CreditsPopup"))
dragElement(document.getElementById("SaveDataPopup"))

function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  if (document.getElementById(elmnt.id + "Header")) {
    // if present, the header is where you move the DIV from:
    document.getElementById(elmnt.id + "Header").onmousedown = dragMouseDown;
  } else {
    // otherwise, move the DIV from anywhere inside the DIV:
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.onmousemove = null;
  }
}

//Sleep function
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}
//Number to better format
function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}



//Update Town Name
function TownNameUpdate(){
  console.log(jsonData.name);
  document.getElementById('title-bar-text').innerHTML = jsonData.name + ".Mistro.exe";
  document.getElementById('Overview-window-header').innerHTML = jsonData.name + " Overview";
}
function UpdateAllVariables(){
  document.getElementById('Population-overview').innerHTML = "Population: " + jsonData.population + " peeps";
  document.getElementById('Money-overview').innerHTML = "Money: $" + numberWithCommas(jsonData.money);
  document.getElementById('Happiness-overview').innerHTML = "Global average Happiness score is: " + jsonData.people.reduce((sum, person) => sum + (person.happiness || 0), 0)/Object.keys(jsonData.people).length;;
}

</script>
</div>  
</body>
</html>